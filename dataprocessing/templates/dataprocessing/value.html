{% extends "main.html" %}

{% block content %}
{% if user.is_authenticated %}
<div class="jumbotron">
       <h2>Ваша экспертная область</h2>
       {% for domain in domain_list %}
                <h4><li>{{domain.name}}</li></h4>
          {% endfor %}

<!-- Кнопка пуска модальное окно -->  
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
  Загрузить элементы РПД
</button>
<a class="btn btn-primary " href="{% url 'post_items' %}" role="button"><i class="material-icons left"></i> Добавить</a>

<!-- Модальное окно -->  
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Загрузите файл с ключевыми словами</h4>
      </div>
      <div class="modal-body">
      <h10> Выбирите предметную область, затем загрузите файл c расширением .txt. На вкладке "Все сущности" можно увидеть загруженные сущности.<br><b>Ключевые слова в файле должны быть перечислены через запятую!</b></h10>
        <form action="/upload/" method="POST" enctype="multipart/form-data" role="form">
       {% csrf_token %}
       <br>
        <select name = 'domain' class="selectpicker" data-live-search="true" id="DomainSelect">
        {% for domain in domain_list %}
        <option>{{domain.name}}</option>
        {% endfor %}
        </select>
        <br>
         <label for="file"></label>
         <input type="file" name="file" id="file" class="form-control" data-filename-placement="inside" title="Выбрать файл" />  
         <br>     
         <button type="submit" class="btn btn-primary" name="submit">Отправить</button>
         </div>
      </form> 
      </div>
    </div>
  </div>
</div>

<p>
<ul class="nav nav-tabs" id="tab-example" role="tablist">
    <li class="nav-item">
        <a class="nav-link" id="fourth-tab" data-toggle="tab"
           href="#fourth-tab-content" role="tab" aria-controls="fourth-tab-content"
           aria-selected="true">Все сущности</a>
    </li>
</ul>
</p>
<div class="tab-content" id="tab-content-example">
<div class="tab-pane fade " id="fourth-tab-content" role="tabpanel"
         aria-labelledby="fourth-tab">
         {% if items_list %} 

          <div class="table-responsive">
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th></th>
                  <th>Название</th>
                  <th>Область</th>
                  <th>Важность</th>
                  <th>Автор</th>
                  <th>Источник</th>
                </tr>
              </thead>
              <tbody>
              {% for item in items_list %}  
              {% for user in item.domain.user.all %} 
                {% if user == request.user %}
                <tr>
                <td>{{item.id}}</td>
                <td><a class="btn btn-link" href="{% url 'edit_items' pk=item.pk %}">{{ item.name }}</a></td>
                 <td>{{item.domain}}</td>
                 <td>{{item.value}}</td>
                 <td>{{item.author.get_full_name}}</td>
                 <td>{{item.source}}</td>
                 <td><a class="btn btn-default" href="{% url 'items_delete' pk=item.pk %}"><span class="glyphicon glyphicon-trash"></span></a></td>
                </tr>
              </tbody>
                {%endif%}
              {% endfor %}   
              {% empty %}
                  <li>Sorry, no athlete in this list!</li>         
              {% endfor %}
            </table>
          </div>   
        </div>
        </div>
        {% endif %} 
            </div>
        </div>

{%else%} 
    <p>У вас нет доступа к этой странице. Обратитесь к администратору</p>
    <li><a href="{% url 'index'%}">Вернуться</a></li>      
{% endif %}       
{% endblock %}
