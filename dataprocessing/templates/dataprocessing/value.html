{% extends "main.html" %}

{% block content %}
{% if user.is_authenticated %}
<div class="jumbotron">
       <h2>Ваша экспертная область</h2>
       {% for domain in domain_list %}
          {% for user in domain.user.all %}
            {% if user == request.user %}
                <h4><li>{{domain.name}}</li></h4>
            {% endif %}
          {% endfor %}
       {% endfor %}
<!-- Кнопка пуска модальное окно -->  
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
  Загрузить элементы РПД
</button>
<a class="btn btn-primary " href="{% url 'post_items' %}" role="button"><i class="material-icons left"></i> Добавить</a>

<!-- Модальное окно -->  
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Загрузите файл с ключевыми словами</h4>
      </div>
      <div class="modal-body">
      <h10> Выбирите предметную область, затем загрузите файл c расширением .txt. На вкладке "Все сущности" можно увидеть загруженные сущности.<br><b>Ключевые слова в файле должны быть перечислены через запятую!</b></h10>
        <form action="/upload/" method="POST" enctype="multipart/form-data" role="form">
       {% csrf_token %}
       <br>
        <select name = 'domain' class="selectpicker" data-live-search="true" id="DomainSelect">
        {% for domain in domain_list %}
        <option>{{domain.name}}</option>
        {% endfor %}
        </select>
        <br>
         <label for="file"></label>
         <input type="file" name="file" id="file" class="form-control" data-filename-placement="inside" title="Выбрать файл" />  
         <br>     
         <button type="submit" class="btn btn-primary" name="submit">Отправить</button>
         </div>
      </form> 
      </div>
    </div>
  </div>
</div>

         
    </div>
<p>
<ul class="nav nav-tabs" id="tab-example" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="first-tab" data-toggle="tab"
           href="#first-tab-content" role="tab" aria-controls="first-tab-content"
           aria-selected="true">Оценить важность</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="second-tab" data-toggle="tab"
           href="#second-tab-content" role="tab" aria-controls="second-tab-content"
           aria-selected="false">Создать связь</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="third-tab" data-toggle="tab"
           href="#third-tab-content" role="tab" aria-controls="third-tab-content"
           aria-selected="false">Выбрать сущность</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="fourth-tab" data-toggle="tab"
           href="#fourth-tab-content" role="tab" aria-controls="fourth-tab-content"
           aria-selected="false">Все сущности</a>
    </li>
</ul>
</p>
<div class="tab-content" id="tab-content-example">
    <div class="tab-pane fade " id="first-tab-content" role="tabpanel"
         aria-labelledby="first-tab">
      <form method="POST" action="">
      {% csrf_token %}
      <div class="form-group col-md-12"> 
      <label class="ItemsSelect" for="ItemsSelect"> Элемент РПД</label>
      <select name = 'name' class="selectpicker" data-live-search="true" id="ItemsSelect">
      {% for item in items_list %}
        {% for user in item.domain.user.all %}
          {% if user == request.user %} 
      <option>{{item.name}}</option>
      {% endif %}
      {% endfor %}
      {% endfor %}
      </select>
      </div>
      <div class="form-group col-md-12"> 
          <label>Оценка</label><br>
          <input type="number" name="value" />
          </div>
      <div class="form-group col-md-12"> 
      <button type="submit" class="btn btn-warning">Сохранить</button>
      </div>
      </form>
    </div>
    <div class="tab-pane fade" id="second-tab-content" role="tabpanel"
         aria-labelledby="second-tab">
      <form method="POST" action="">
      {% csrf_token %}
      <div class="form-row">
      <div class="form-group col-md-6">
      <label for="ItemsSelect">Элемент РПД 1</label>
      <select name = 'name' class="selectpicker" data-live-search="true" id="ItemsSelect">
      {% for item in items_list %}
      <option>{{item.name}}</option>
      {% endfor %}
      </select>
      <a style="color:green;"class="glyphicon glyphicon-plus" href="{% url 'post_items' %}" role="button"><i class="material-icons left"></i></a>
      </div>
    <div class="form-group col-md-12">
    <label>Связь</label>
    <select name = 'relation' class="selectpicker" data-live-search="true" id="ItemsSelect2">
      <option>0 - неопределённое</option>
      <option>1 - включает в себя</option>
      <option>2 - является пререквизитом для</option>
      <option>3 - тождество</option>
      <option>4 - являются частями одного раздела</option>
      <option>5 - отсутствует</option>
      </select>
    </div>
    <div class="form-group col-md-6">
      <label for="ItemsSelect2">Элемент РПД 2</label>
      <select name = 'name2' class="selectpicker" data-live-search="true" id="ItemsSelect2">
      {% for item in items_list %}
      <option>{{item.name}}</option>
      {% endfor %}
      </select>
      <a style="color:green;"class="glyphicon glyphicon-plus" href="{% url 'post_items' %}" role="button"><i class="material-icons left"></i></a>
  </div>
  </div>
    <div class="form-group col-md-12">
      <button type="submit" class="btn btn-warning">Сохранить</button>
    </div>
    </form>
    </div>
    <div class="tab-pane fade" id="third-tab-content" role="tabpanel"
         aria-labelledby="third-tab">
      <form method="POST" action="">
      {% csrf_token %}
      <div class="form-row">
      <div class="form-group col-md-6">
      <label for="ItemsSelect3">Выберете из списка: </label>
      <select name = 'name' class="form-control" id="ItemsSelect3">
      {% for item in random_items %}
      <option>{{item}}</option>
      {% endfor %}
      </select>
      <input type="hidden" name="rand" value="{{random_items}}" />
  </div>
    <div class="form-group col-md-12">
      <button type="submit" class="btn btn-warning">Сохранить</button>
    </div>
    </form>
    </div>
</div>
<div class="tab-pane fade" id="fourth-tab-content" role="tabpanel"
         aria-labelledby="fourth-tab">
         {% if items_list %} 

          <div class="table-responsive">
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th></th>
                  <th>Название</th>
                  <th>Область</th>
                  <th>Важность</th>
                  <th>Автор</th>
                  <th>Источник</th>
                </tr>
              </thead>
              <tbody>
              {% for item in items_list %}  
              {% for user in item.domain.user.all %} 
                {% if user == request.user %}
                <tr>
                <td>{{item.id}}</td>
                <td><a class="btn btn-link" href="{% url 'edit_items' pk=item.pk %}">{{ item.name }}</a></td>
                 <td>{{item.domain}}</td>
                 <td>{{item.value}}</td>
                 <td>{{item.author.get_full_name}}</td>
                 <td>{{item.source}}</td>
                </tr>
              </tbody>
                {%endif%}
              {% endfor %}   
              {% empty %}
                  <li>Sorry, no athlete in this list!</li>         
              {% endfor %}
            </table>
          </div>   
        </div>
        </div>
        {% endif %} 
            </div>
        </div>

{%else%} 
    <p>У вас нет доступа к этой странице. Обратитесь к администратору</p>
    <li><a href="{% url 'index'%}">Вернуться</a></li>      
{% endif %}       
{% endblock %}
